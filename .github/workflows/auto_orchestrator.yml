// services/autonomousOrchestrator.ts

export async function runAutonomousCycle() {
  // 1. DISCOVERY & TRIAGE (Existing Logic)
  const triageNote = await sentinel.getTriage();
  if (triageNote.status === "no_signal_detected") return triageNote;

  // 2. EDITORIAL SYNTHESIS (Existing Logic)
  const articleDraft = await editorialChief.synthesize(triageNote);

  // 3. NEW: THE CREATIVE DIRECTOR STEP 
  // The AI now "reads" the article and generates a bespoke image prompt
  const imagePrompt = await creativeDirector.generatePrompt(articleDraft.content);

  // 4. CALL IMAGE GENERATOR (Nano Banana 2 / Gemini 3 Flash Image)
  // This step creates the 8k architectural asset
  const generatedImgUrl = await imageGenerator.create({
    prompt: imagePrompt,
    aspect_ratio: "21:9", // Matches your PublicPortal layout
    style: "Architectural, Minimalist, High-Contrast"
  });

  // 5. FINAL JSON ASSEMBLY
  // We replace the placeholder Unsplash URL with your unique AI asset
  const finalArticle = {
    ...articleDraft,
    img: generatedImgUrl, // Now a unique, agency-grade asset
    last_cycle_status: "COMPLETE_WITH_VISUAL"
  };

  return finalArticle;
}
